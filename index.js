(()=>{"use strict";const t=class{constructor(t,{inputSelector:e,submitButtonSelector:s,inactiveButtonClass:n,inputErrorClass:i,errorClass:o,...r}){this._form=t,this._inputSelector=e,this._submitButtonSelector=s,this._inactiveButtonClass=n,this._inputErrorClass=i,this._errorClass=o,this._additionalParams=r}enableValidation(){this._formInputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._formButton=this._form.querySelector(this._submitButtonSelector),this._setEventListeners(),this.toggleButtonState()}toggleButtonState(){this._hasInvalidInput()?this.disableButton():this._enableButton()}_setEventListeners(){this.disableButton(),this._formInputs.forEach((t=>{t.addEventListener("input",(e=>{this._checkInputValidity(t),this.toggleButtonState()}))}))}_checkInputValidity(t){const e=this._form.querySelector(`#${t.id}-error`);t.checkValidity()?(e.textContent="",e.classList.remove(this._errorClass)):(e.textContent=t.validationMessage,e.classList.add(this._errorClass))}disableButton(){this._formButton.classList.add(this._inactiveButtonClass),this._formButton.setAttribute("disabled","")}_enableButton(){this._formButton.classList.remove(this._inactiveButtonClass),this._formButton.removeAttribute("disabled","")}_hasInvalidInput(){return this._formInputs.some((t=>!t.validity.valid))}},e={inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_invalid",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},s=document.querySelector("#popup-form-add"),n=document.querySelector("#popup-form-info"),i=document.querySelector(".profile__add-button"),o=document.querySelector(".profile__avatar-button"),r=document.querySelector("#popup-form-avatar");class a{constructor(t){this._popup=document.querySelector(t),this._popupCloseButton=this._popup.querySelector(".popup__close"),this._deleteForm=this._popup.querySelector(".popup__form")}_handleClosePopupByEsc=t=>{"Escape"===t.key&&this.close()};_handleClosePopupOnOverlay=t=>{t.target===t.currentTarget&&this.close()};_handleClosePopupButton=()=>{this.close()};setEventListener(){this._popupCloseButton.addEventListener("click",this._handleClosePopupButton),this._popup.addEventListener("click",this._handleClosePopupOnOverlay)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleClosePopupByEsc)}close(t){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleClosePopupByEsc)}}class l extends a{constructor(t,e){super(t),this._submit=e,this._form=this._popup.querySelector(".popup__form"),this._input=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelector(".popup__save-button"),this._startTextContentButton=this._submitButton.textContent}_getInputValues(){return this._value={},this._input.forEach((t=>{this._value[t.name]=t.value})),this._value}setInputValues(t){this._input.forEach((e=>{e.value=t[e.name]}))}setEventListeners(){super.setEventListener(),this._form.addEventListener("submit",(t=>{t.preventDefault(),this._submitButton.textContent="Сохранение...",this._submit(this._getInputValues())}))}setStartText(){this._submitButton.textContent=this._startTextContentButton}close(){super.close(),this._form.reset()}}const u=new class{constructor(t){this._baseUrl=t.baseUrl,this._headers=t.headers,this._authorization=t.headers.authorization}_returnRes(t){return t.ok?t.json():Promise.reject}getData(){return fetch(`${this._baseUrl}/users/me`,{headers:{authorization:this._authorization}}).then(this._returnRes)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:{authorization:this._authorization}}).then(this._returnRes)}setUserData(t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t.name,about:t.info})}).then(this._returnRes)}setAvatar(t){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t.avatar})}).then(this._returnRes)}addNewCard(t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t.title,link:t.link})}).then(this._returnRes)}addlike(t){return fetch(`${this._baseUrl}/cards/${t}/likes`,{method:"PUT",headers:{authorization:this._authorization}}).then(this._returnRes)}deleteLike(t){return fetch(`${this._baseUrl}/cards/${t}/likes`,{method:"DELETE",headers:{authorization:this._authorization}}).then(this._returnRes)}deleteCard(t){return fetch(`${this._baseUrl}/cards/${t}`,{method:"DELETE",headers:{authorization:this._authorization}}).then(this._returnRes)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-66",headers:{authorization:"fb04fe28-7bc0-4cbf-bc40-2c92feffd1a0","Content-Type":"application/json"}}),h=new t(s,e),_=new t(n,e),c=new t(r,e);h.enableValidation(),_.enableValidation(),c.enableValidation();const p=new class extends a{constructor(t){super(t),this._popupImage=this._popup.querySelector(".popup__image"),this._popupImageTitle=this._popup.querySelector(".popup__image-title")}open=t=>{this._popupImage.src=t.link,this._popupImage.alt=t.title,this._popupImageTitle.textContent=t.title,super.open()}}("#popup-image"),d=new class{constructor(t){this._profileName=document.querySelector(t.userNameSelector),this._profileDescription=document.querySelector(t.userDescriptionSelector),this._profileImage=document.querySelector(t.userImageSelector)}getUserInfo(){return{name:this._profileName.textContent,info:this._profileDescription.textContent}}setUserInfo({avatar:t,name:e,info:s}){this._profileImage.src=t,this._profileName.textContent=e,this._profileDescription.textContent=s}}({userNameSelector:".profile__title",userDescriptionSelector:".profile__subtitle",userImageSelector:".profile__avatar"}),m=new class extends a{constructor(t,e){super(t),this._deleteSubmit=e,this._deleteForm=this._popup.querySelector(".popup__form"),this._submitButton=this._popup.querySelector(".popup__save-button"),this._startTextContentButton=this._submitButton.textContent}setEventListeners(){super.setEventListener(),this._deleteForm.addEventListener("submit",(t=>{t.preventDefault(),this._submitButton.textContent=`${this._submitButton.textContent}...`,this._deleteSubmit({card:this._card,cardId:this._cardId})}))}setStartText(){this._submitButton.textContent=this._startTextContentButton}open=({card:t,cardId:e})=>{super.open(),this._card=t,this._cardId=e}}("#popup-delete",(({card:t,cardId:e})=>{u.deleteCard(e).then((()=>{t.removeCardElement(),m.close()})).catch((t=>console.log(`Ошибка при создании данных ${t}`))).finally((()=>m.setStartText()))}));function v(t){const e=new class{constructor(t,e,s,n,i){this._cardData=t,this._selectorTemplate=e,this._handleOpenPopup=s,this._idUser=t.idUser,this._idOwner=t.owner._id,this._likes=t.likes,this._likesQuantity=t.likes.length,this._changeLikes=n,this._cardId=t._id,this._openDeletePopup=i}_getNewCardFromTemplate(){return document.querySelector(this._selectorTemplate).content.querySelector(".element").cloneNode(!0)}_handleButtonLike=()=>{this._changeLikes(this._buttonLikeElement,this._cardId)};_removeTrashButton(){this._idUser===this._idOwner?this._buttonDeleteElement.style.display="block":this._buttonDeleteElement.style.display="none"}_changeLikeQuantity(){this._likes.forEach((t=>{t._id!==this._idUser||this._buttonLikeElement.classList.add("element__button-like_active")})),this._counter.textContent=this._likesQuantity}toggleLikes(t){this._buttonLikeElement.classList.toggle("element__button-like_active"),this._counter.textContent=t.length}removeCardElement(){this._cloneElement.remove(),this._cloneElement=null}_setEventListeners(){this._buttonLikeElement.addEventListener("click",this._handleButtonLike),this._buttonDeleteElement.addEventListener("click",(()=>this._openDeletePopup({card:this,cardId:this._cardId}))),this._imageElement.addEventListener("click",(()=>this._handleOpenPopup(this._cardData)))}createCard(){return this._cloneElement=this._getNewCardFromTemplate(),this._imageElement=this._cloneElement.querySelector(".element__image"),this._buttonLikeElement=this._cloneElement.querySelector(".element__button-like"),this._buttonDeleteElement=this._cloneElement.querySelector(".element__button-delete"),this._counter=this._cloneElement.querySelector(".element__counter"),this._titleElement=this._cloneElement.querySelector(".element__title").textContent=this._cardData.name,this._imageElement.src=this._cardData.link,this._imageElement.alt=this._cardData.name,this._removeTrashButton(),this._setEventListeners(),this._changeLikeQuantity(),this._cloneElement}}(t,".template-cards",p.open,((t,s)=>{t.classList.contains("element__button-like_active")?u.deleteLike(s).then((t=>{e.toggleLikes(t.likes)})).catch((t=>console.log(`Ошибка при создании данных ${t}`))):u.addlike(s).then((t=>{e.toggleLikes(t.likes)})).catch((t=>console.log(`Ошибка при создании данных ${t}`)))}),m.open);return e.createCard()}const f=new class{constructor(t,e){this._renderer=t,this._container=document.querySelector(e)}addCardArray(t){t.forEach((t=>{this._renderer(t)}))}addItem(t){this._container.prepend(t)}}((t=>{f.addItem(v(t))}),".elements"),b=new l("#popup-profile",(t=>{u.setUserData(t).then((t=>{d.setUserInfo({name:t.name,info:t.about,avatar:t.avatar})})).catch((t=>console.log(`Ошибка при создании данных ${t}`))).finally((()=>b.setStartText())),b.close()})),E=new l("#popup-avatar",(t=>{u.setAvatar(t).then((t=>{d.setUserInfo({name:t.name,info:t.about,avatar:t.avatar}),E.close()})).catch((t=>console.log(`Ошибка при создании данных ${t}`))).finally((()=>E.setStartText()))})),g=new l("#popup-add",(t=>{Promise.all([u.getData(),u.addNewCard(t)]).then((([t,e])=>{e.idUser=t._id,f.addItem(v(e))})).catch((t=>console.log(`Ошибка при создании данных ${t}`))).finally((()=>g.setStartText())),g.close()}));E.setEventListeners(),g.setEventListeners(),p.setEventListener(),b.setEventListeners(),m.setEventListeners(),document.querySelector(".profile__edit-button").addEventListener("click",(()=>{b.setInputValues(d.getUserInfo()),b.open(),_.disableButton()})),o.addEventListener("click",(()=>{c.toggleButtonState(),E.open()})),i.addEventListener("click",(()=>{h.toggleButtonState(),g.open()})),Promise.all([u.getData(),u.getInitialCards()]).then((([t,e])=>{e.forEach((e=>e.idUser=t._id)),d.setUserInfo({name:t.name,info:t.about,avatar:t.avatar}),f.addCardArray(e.reverse())})).catch((t=>console.log(`Ошибка при создании данных ${t}`)))})();