(()=>{"use strict";const e=class{constructor(e,{inputSelector:t,submitButtonSelector:s,inactiveButtonClass:o,inputErrorClass:n,errorClass:i,...r}){this._form=e,this._inputSelector=t,this._submitButtonSelector=s,this._inactiveButtonClass=o,this._inputErrorClass=n,this._errorClass=i,this._additionalParams=r}enableValidation(){this._formInputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._formButton=this._form.querySelector(this._submitButtonSelector),this._setEventListeners(),this.toggleButtonState()}toggleButtonState(){this._hasInvalidInput()?this.disableButton():this._enableButton()}_setEventListeners(){this.disableButton(),this._formInputs.forEach((e=>{e.addEventListener("input",(t=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}_checkInputValidity(e){const t=this._form.querySelector(`#${e.id}-error`);e.checkValidity()?(t.textContent="",t.classList.remove(this._errorClass)):(t.textContent=e.validationMessage,t.classList.add(this._errorClass))}disableButton(){this._formButton.classList.add(this._inactiveButtonClass),this._formButton.setAttribute("disabled","")}_enableButton(){this._formButton.classList.remove(this._inactiveButtonClass),this._formButton.removeAttribute("disabled","")}_hasInvalidInput(){return this._formInputs.some((e=>!e.validity.valid))}},t={inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_invalid",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},s=document.querySelector("#popup-form-add"),o=document.querySelector("#popup-form-info"),n=document.querySelector(".profile__add-button");class i{constructor(e){this._popup=document.querySelector(e),this._popupCloseButton=this._popup.querySelector(".popup__close")}_handleClosePopupByEsc=e=>{"Escape"===e.key&&this.close()};_handleClosePopupOnOverlay=e=>{e.target===e.currentTarget&&this.close()};_handleClosePopupButton=()=>{this.close()};setEventListener(){this._popupCloseButton.addEventListener("click",this._handleClosePopupButton),this._popup.addEventListener("click",this._handleClosePopupOnOverlay)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleClosePopupByEsc)}close(e){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleClosePopupByEsc)}}class r extends i{constructor(e,t){super(e),this._submit=t,this._form=this._popup.querySelector(".popup__form"),this._input=this._form.querySelectorAll(".popup__input")}_getInputValues(){return this._value={},this._input.forEach((e=>{this._value[e.name]=e.value})),this._value}setInputValues(e){this._input.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListener(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submit(this._getInputValues())}))}close(){super.close(),this._form.reset()}}const l=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers,this._authorization=e.headers.authorization}_returnRes(e){return e.ok?e.json():Promise.reject}getData(){return fetch(`${this._baseUrl}/users/me`,{headers:{authorization:this._authorization}}).then(this._returnRes)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:{authorization:this._authorization}}).then(this._returnRes)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-66",headers:{authorization:"fb04fe28-7bc0-4cbf-bc40-2c92feffd1a0","Content-Type":"application/json"}}),a=new e(s,t),u=new e(o,t);a.enableValidation(),u.enableValidation();const p=new class extends i{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__image"),this._popupImageTitle=this._popup.querySelector(".popup__image-title")}open=e=>{this._popupImage.src=e.link,this._popupImage.alt=e.title,this._popupImageTitle.textContent=e.title,super.open()}}("#popup-image"),_=new class{constructor(e){this._profileName=document.querySelector(e.userNameSelector),this._profileDescription=document.querySelector(e.userDescriptionSelector),this._profileImage=document.querySelector(e.userImageSelector)}getUserInfo(){return{name:this._profileName.textContent,info:this._profileDescription.textContent}}setUserInfo({image:e,name:t,info:s}){this._profileImage.src=e,this._profileName.textContent=t,this._profileDescription.textContent=s}}({userNameSelector:".profile__title",userDescriptionSelector:".profile__subtitle",userImageSelector:".profile__avatar"}),c=new class{constructor(e,t){this._renderer=e,this._container=document.querySelector(t)}addCardArray(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}((e=>{c.addItem(function(e){return new class{constructor(e,t,s){this._cardData=e,this._selectorTemplate=t,this._handleOpenPopup=s,this._idUser=e.idUser,this._idOwner=e.owner._id}_getNewCardFromTemplate(){return document.querySelector(this._selectorTemplate).content.querySelector(".element").cloneNode(!0)}_handleButtonLike=()=>{this._buttonLikeElement.classList.toggle("element__button-like_active")};_removeTrashButton(){this._idUser===this._idOwner?this._buttonDeleteElement.style.display="block":this._buttonDeleteElement.style.display="none"}_handleButtonDeleteElement=()=>{this._cloneElement.remove(),this._cloneElement=null};_setEventListeners(){this._buttonLikeElement.addEventListener("click",this._handleButtonLike),this._buttonDeleteElement.addEventListener("click",this._handleButtonDeleteElement),this._imageElement.addEventListener("click",(()=>this._handleOpenPopup(this._cardData)))}createCard(){return this._cloneElement=this._getNewCardFromTemplate(),this._imageElement=this._cloneElement.querySelector(".element__image"),this._buttonLikeElement=this._cloneElement.querySelector(".element__button-like"),this._buttonDeleteElement=this._cloneElement.querySelector(".element__button-delete"),this._titleElement=this._cloneElement.querySelector(".element__title").textContent=this._cardData.name,this._imageElement.src=this._cardData.link,this._imageElement.alt=this._cardData.name,this._removeTrashButton(),this._setEventListeners(),this._cloneElement}}(e,".template-cards",p.open).createCard()}(e))}),".elements"),h=new r("#popup-profile",(e=>{_.setUserInfo(e),h.close()})),d=new r("#popup-add",(e=>{c.addItem(e),d.close()}));d.setEventListeners(),p.setEventListener(),h.setEventListeners(),document.querySelector(".profile__edit-button").addEventListener("click",(()=>{h.setInputValues(_.getUserInfo()),h.open(),u.disableButton()})),n.addEventListener("click",(()=>{a.toggleButtonState(),d.open()})),Promise.all([l.getData(),l.getInitialCards()]).then((([e,t])=>{t.forEach((t=>t.idUser=e._id)),_.setUserInfo({name:e.name,info:e.about,image:e.avatar}),c.addCardArray(t.reverse())}))})();